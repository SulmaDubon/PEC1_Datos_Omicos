<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sulma Dubon">
<meta name="dcterms.date" content="2024-11-01">

<title>PEC1: Datos Ómicos</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Pec1_files/libs/clipboard/clipboard.min.js"></script>
<script src="Pec1_files/libs/quarto-html/quarto.js"></script>
<script src="Pec1_files/libs/quarto-html/popper.min.js"></script>
<script src="Pec1_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Pec1_files/libs/quarto-html/anchor.min.js"></script>
<link href="Pec1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Pec1_files/libs/quarto-html/quarto-syntax-highlighting-2486e1f0a3ee9ee1fc393803a1361cdb.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Pec1_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Pec1_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Pec1_files/libs/bootstrap/bootstrap-5bdc1ec511977dd36301403cf8f4f68d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract"><span class="header-section-number">1</span> Abstract</a></li>
  <li><a href="#materiales-y-métodos" id="toc-materiales-y-métodos" class="nav-link" data-scroll-target="#materiales-y-métodos"><span class="header-section-number">2</span> Materiales y Métodos</a>
  <ul class="collapse">
  <li><a href="#descarga-de-los-datos-desde-el-repositorio-metabolomicsworkbench" id="toc-descarga-de-los-datos-desde-el-repositorio-metabolomicsworkbench" class="nav-link" data-scroll-target="#descarga-de-los-datos-desde-el-repositorio-metabolomicsworkbench"><span class="header-section-number">2.1</span> Descarga de los datos desde el repositorio “metabolomicsWorkbench”</a>
  <ul class="collapse">
  <li><a href="#preparacion-para-la-descarga" id="toc-preparacion-para-la-descarga" class="nav-link" data-scroll-target="#preparacion-para-la-descarga"><span class="header-section-number">2.1.1</span> Preparacion para la descarga</a></li>
  <li><a href="#descargar-datos-del-estudio" id="toc-descargar-datos-del-estudio" class="nav-link" data-scroll-target="#descargar-datos-del-estudio"><span class="header-section-number">2.1.2</span> Descargar Datos del Estudio</a></li>
  <li><a href="#leer-los-datos-y-revisar-su-estructura" id="toc-leer-los-datos-y-revisar-su-estructura" class="nav-link" data-scroll-target="#leer-los-datos-y-revisar-su-estructura"><span class="header-section-number">2.1.3</span> Leer los Datos y Revisar su Estructura</a></li>
  </ul></li>
  <li><a href="#creacion-de-summarizedexperiment" id="toc-creacion-de-summarizedexperiment" class="nav-link" data-scroll-target="#creacion-de-summarizedexperiment"><span class="header-section-number">2.2</span> Creacion de SummarizedExperiment</a>
  <ul class="collapse">
  <li><a href="#creacion-de-assays-y-coldata-para-el-summarizedexperiment" id="toc-creacion-de-assays-y-coldata-para-el-summarizedexperiment" class="nav-link" data-scroll-target="#creacion-de-assays-y-coldata-para-el-summarizedexperiment"><span class="header-section-number">2.2.1</span> Creacion de “assays” y “colData” para el SummarizedExperiment</a></li>
  <li><a href="#descargar-metadatos-del-estudio" id="toc-descargar-metadatos-del-estudio" class="nav-link" data-scroll-target="#descargar-metadatos-del-estudio"><span class="header-section-number">2.2.2</span> Descargar Metadatos del Estudio</a></li>
  <li><a href="#procesar-los-metadatos-desde-html" id="toc-procesar-los-metadatos-desde-html" class="nav-link" data-scroll-target="#procesar-los-metadatos-desde-html"><span class="header-section-number">2.2.3</span> Procesar los Metadatos desde HTML</a></li>
  <li><a href="#crear-el-summarizedexperiment-utilizando-el-diccionario-de-metadatos" id="toc-crear-el-summarizedexperiment-utilizando-el-diccionario-de-metadatos" class="nav-link" data-scroll-target="#crear-el-summarizedexperiment-utilizando-el-diccionario-de-metadatos"><span class="header-section-number">2.2.4</span> Crear el SummarizedExperiment Utilizando el Diccionario de Metadatos</a></li>
  <li><a href="#verificamos-summarizedexperiment" id="toc-verificamos-summarizedexperiment" class="nav-link" data-scroll-target="#verificamos-summarizedexperiment"><span class="header-section-number">2.2.5</span> Verificamos SummarizedExperiment</a></li>
  </ul></li>
  <li><a href="#exploracion-del-dataset" id="toc-exploracion-del-dataset" class="nav-link" data-scroll-target="#exploracion-del-dataset"><span class="header-section-number">2.3</span> Exploracion del dataset</a>
  <ul class="collapse">
  <li><a href="#informacion-del-estudio" id="toc-informacion-del-estudio" class="nav-link" data-scroll-target="#informacion-del-estudio"><span class="header-section-number">2.3.1</span> Informacion del estudio</a></li>
  </ul></li>
  <li><a href="#control-de-calidad-de-los-datos" id="toc-control-de-calidad-de-los-datos" class="nav-link" data-scroll-target="#control-de-calidad-de-los-datos"><span class="header-section-number">2.4</span> Control de calidad de los datos</a>
  <ul class="collapse">
  <li><a href="#control-de-calidad-de-los-metadatos-coldata" id="toc-control-de-calidad-de-los-metadatos-coldata" class="nav-link" data-scroll-target="#control-de-calidad-de-los-metadatos-coldata"><span class="header-section-number">2.4.1</span> Control de calidad de los metadatos (colData)</a></li>
  <li><a href="#control-de-calidad-de-la-matriz-de-datos-cuantitativos-assay" id="toc-control-de-calidad-de-la-matriz-de-datos-cuantitativos-assay" class="nav-link" data-scroll-target="#control-de-calidad-de-la-matriz-de-datos-cuantitativos-assay"><span class="header-section-number">2.4.2</span> Control de Calidad de la Matriz de Datos Cuantitativos (assay)</a></li>
  </ul></li>
  <li><a href="#exploracion-de-los-datos" id="toc-exploracion-de-los-datos" class="nav-link" data-scroll-target="#exploracion-de-los-datos"><span class="header-section-number">2.5</span> Exploracion de los datos</a>
  <ul class="collapse">
  <li><a href="#resumen-estadístico-de-la-matriz-cuantitativa" id="toc-resumen-estadístico-de-la-matriz-cuantitativa" class="nav-link" data-scroll-target="#resumen-estadístico-de-la-matriz-cuantitativa"><span class="header-section-number">2.5.1</span> Resumen Estadístico de la Matriz Cuantitativa</a></li>
  <li><a href="#visualización-general-histograma-de-todos-los-valores" id="toc-visualización-general-histograma-de-todos-los-valores" class="nav-link" data-scroll-target="#visualización-general-histograma-de-todos-los-valores"><span class="header-section-number">2.5.2</span> Visualización General: Histograma de Todos los Valores</a></li>
  <li><a href="#normalizacion-transformación-logarítmica" id="toc-normalizacion-transformación-logarítmica" class="nav-link" data-scroll-target="#normalizacion-transformación-logarítmica"><span class="header-section-number">2.5.3</span> Normalizacion: Transformación Logarítmica</a></li>
  </ul></li>
  <li><a href="#análisis-de-los-datos" id="toc-análisis-de-los-datos" class="nav-link" data-scroll-target="#análisis-de-los-datos"><span class="header-section-number">2.6</span> Análisis de los datos</a></li>
  <li><a href="#pregunta-a-responder-existen-diferencias-significativas-en-los-perfiles-metabólicos-del-tejido-cardiaco-entre-individuos-jóvenes-y-mayores-y-cuáles-son-las-principales-características-que-permiten-diferenciar-entre-estos-grupos" id="toc-pregunta-a-responder-existen-diferencias-significativas-en-los-perfiles-metabólicos-del-tejido-cardiaco-entre-individuos-jóvenes-y-mayores-y-cuáles-son-las-principales-características-que-permiten-diferenciar-entre-estos-grupos" class="nav-link" data-scroll-target="#pregunta-a-responder-existen-diferencias-significativas-en-los-perfiles-metabólicos-del-tejido-cardiaco-entre-individuos-jóvenes-y-mayores-y-cuáles-son-las-principales-características-que-permiten-diferenciar-entre-estos-grupos"><span class="header-section-number">2.7</span> Pregunta a responder: “¿Existen diferencias significativas en los perfiles metabólicos del tejido cardiaco entre individuos jóvenes y mayores, y cuáles son las principales características que permiten diferenciar entre estos grupos?”</a>
  <ul class="collapse">
  <li><a href="#análisis-de-componentes-principales-pca-usando-mixomics-de-los-datos-transformados" id="toc-análisis-de-componentes-principales-pca-usando-mixomics-de-los-datos-transformados" class="nav-link" data-scroll-target="#análisis-de-componentes-principales-pca-usando-mixomics-de-los-datos-transformados"><span class="header-section-number">2.7.1</span> Análisis de Componentes Principales PCA usando mixOmics de los datos transformados</a></li>
  <li><a href="#análisis-discriminante-pls-usando-mixomics-de-los-datos-transformados" id="toc-análisis-discriminante-pls-usando-mixomics-de-los-datos-transformados" class="nav-link" data-scroll-target="#análisis-discriminante-pls-usando-mixomics-de-los-datos-transformados"><span class="header-section-number">2.7.2</span> Análisis Discriminante PLS usando mixOmics de los datos transformados</a></li>
  <li><a href="#gráfico-de-tasa-de-error-de-clasificación" id="toc-gráfico-de-tasa-de-error-de-clasificación" class="nav-link" data-scroll-target="#gráfico-de-tasa-de-error-de-clasificación"><span class="header-section-number">2.7.3</span> Gráfico de Tasa de Error de Clasificación</a></li>
  <li><a href="#grafico-pls-da-componentes-principales-1-y-2" id="toc-grafico-pls-da-componentes-principales-1-y-2" class="nav-link" data-scroll-target="#grafico-pls-da-componentes-principales-1-y-2"><span class="header-section-number">2.7.4</span> Grafico PLS-DA: Componentes principales 1 y 2):</a></li>
  <li><a href="#graficar-el-círculo-de-correlación" id="toc-graficar-el-círculo-de-correlación" class="nav-link" data-scroll-target="#graficar-el-círculo-de-correlación"><span class="header-section-number">2.7.5</span> Graficar el círculo de correlación</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="Pec1.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">PEC1: Datos Ómicos</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sulma Dubon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="abstract" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Abstract</h1>
<p>En este documento, se describe el proceso para crear un objeto SummarizedExperiment a partir de datos de metabolómica descargados, utilizando R para preparar tanto los metadatos como los datos cuantitativos de manera estructurada y reproducible. El objetivo era organizar los datos fenotópicos y cuantitativos para poder realizar análisis ómicos avanzados. # Objetivos del Estudio</p>
</section>
<section id="materiales-y-métodos" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Materiales y Métodos</h1>
<p>Cargar Librerías Necesarias</p>
<section id="descarga-de-los-datos-desde-el-repositorio-metabolomicsworkbench" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="descarga-de-los-datos-desde-el-repositorio-metabolomicsworkbench"><span class="header-section-number">2.1</span> Descarga de los datos desde el repositorio “metabolomicsWorkbench”</h2>
<p>Para nuestro trabajo seleccionamos obtener la informacion desde el repositorio a travez de la descarga directa, usando los URLs, esta parte del trabajo es de froma dinamica por lo que creamos un archivo en quarto que nos permita manejar los params: “dataset_url y metadata_url”, con dataset_url obtendermos los datos para “assay”, “colData” y “rowData” y con metadata_url obtendremos la infrormacion de los metadatos asociados al conjunto de datos, este codigo esta preparado para recibir datos en formato plano .txt y HTML</p>
<p>El codigo maneja: * La cracion de la carpeta “data” si no existe. Guarda los archivos descargados y organizar el proyecto. * A partir de ambas URLs (dataset_url y metadata_url), se extrae un identificador único del estudio mediante una expresión regular (ST\d{6}). Este identificador se compara entre ambos enlaces para verificar que efectivamente corresponden al mismo estudio. Si los identificadores no coinciden, se detiene el proceso y se muestra un mensaje de error al usuario, indicando la discrepancia. Esto es fundamental para asegurar la coherencia en los datos descargados. * Asignación de Nombres a los Archivos: Una vez verificado el identificador del estudio, se genera un nombre de archivo único basado en este ID * Descarga de los archivos * Durante el proceso se manejan mensajes y excepciones: * Se considero evitar descargas innecesarias y sobreescribir informacion</p>
<section id="preparacion-para-la-descarga" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="preparacion-para-la-descarga"><span class="header-section-number">2.1.1</span> Preparacion para la descarga</h3>
</section>
<section id="descargar-datos-del-estudio" class="level3" data-number="2.1.2">
<h3 data-number="2.1.2" class="anchored" data-anchor-id="descargar-datos-del-estudio"><span class="header-section-number">2.1.2</span> Descargar Datos del Estudio</h3>
</section>
<section id="leer-los-datos-y-revisar-su-estructura" class="level3" data-number="2.1.3">
<h3 data-number="2.1.3" class="anchored" data-anchor-id="leer-los-datos-y-revisar-su-estructura"><span class="header-section-number">2.1.3</span> Leer los Datos y Revisar su Estructura</h3>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Resumen del Dataset: Primeras 5 Filas y 5 Columnas</caption>
<colgroup>
<col style="width: 6%">
<col style="width: 43%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Samples</th>
<th style="text-align: left;">group</th>
<th style="text-align: right;">X1261.82410453_13.462</th>
<th style="text-align: right;">X1421.94930453_13.687</th>
<th style="text-align: right;">X1443.93365453_13.687</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">young_1</td>
<td style="text-align: left;">Sample source:Heart | Sex:M | Age group:young</td>
<td style="text-align: right;">8.2889</td>
<td style="text-align: right;">36.8705</td>
<td style="text-align: right;">6.0068</td>
</tr>
<tr class="even">
<td style="text-align: left;">young_2</td>
<td style="text-align: left;">Sample source:Heart | Sex:M | Age group:young</td>
<td style="text-align: right;">9.1300</td>
<td style="text-align: right;">11.2341</td>
<td style="text-align: right;">3.2156</td>
</tr>
<tr class="odd">
<td style="text-align: left;">young_3</td>
<td style="text-align: left;">Sample source:Heart | Sex:M | Age group:young</td>
<td style="text-align: right;">9.0886</td>
<td style="text-align: right;">7.6486</td>
<td style="text-align: right;">5.4975</td>
</tr>
<tr class="even">
<td style="text-align: left;">young_4</td>
<td style="text-align: left;">Sample source:Heart | Sex:M | Age group:young</td>
<td style="text-align: right;">7.9396</td>
<td style="text-align: right;">13.3439</td>
<td style="text-align: right;">4.6751</td>
</tr>
<tr class="odd">
<td style="text-align: left;">young_5</td>
<td style="text-align: left;">Sample source:Heart | Sex:M | Age group:young</td>
<td style="text-align: right;">8.9580</td>
<td style="text-align: right;">19.0862</td>
<td style="text-align: right;">14.1100</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="creacion-de-summarizedexperiment" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="creacion-de-summarizedexperiment"><span class="header-section-number">2.2</span> Creacion de SummarizedExperiment</h2>
<p>Para crar el SummarizedExperiment tenemos que tener en cuenta lo siguiente: Las muestas estan represenadas en la filas y las variables en columnas para cumplir con la estructura del SummarizedExperiment transponemos la matriz de datos.</p>
<p>La columna group contenía información fenotípica agrupada, como la fuente de la muestra (source), el sexo (sex), y el grupo de edad (age_group). Se utilizó la función tidyr::separate() para dividir esta columna en tres columnas distintas. Adicionalmente, se limpiaron los valores de cada columna para eliminar los prefijos (“Sample source:”, “Sex:”, “Age group:”) y se trató cualquier valor faltante, reemplazando con NA cuando fuera necesario.</p>
<p>Las columnas fueron renombradas de forma consistente como Met_1, Met_2, etc., para hacer que el conjunto de datos fuera más comprensible y organizado.</p>
<p>Los metadatos (colData) se estructuraron utilizando las columnas Sample, source, sex, y age_group. La columna Sample fue eliminada del colData como columna independiente y, en cambio, se utilizó como identificador (nombres de fila) para evitar redundancias. Los datos cuantitativos de los metabolitos (assay) se organizaron en una matriz, donde las muestras fueron establecidas como columnas y los metabolitos como filas.</p>
<p>Finalmente, se utilizó la función SummarizedExperiment() del paquete SummarizedExperiment para crear el objeto.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sample source:Heart | Sex:M | Age group:young"
[2] "Sample source:Heart | Sex:F | Age group:young"
[3] "Sample source:Heart | Sex:F | Age group:old"  
[4] "Sample source:Heart | Sex:M | Age group:old"  </code></pre>
</div>
</div>
<section id="creacion-de-assays-y-coldata-para-el-summarizedexperiment" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="creacion-de-assays-y-coldata-para-el-summarizedexperiment"><span class="header-section-number">2.2.1</span> Creacion de “assays” y “colData” para el SummarizedExperiment</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 23 rows and 3 columns
             source         sex   age_group
        &lt;character&gt; &lt;character&gt; &lt;character&gt;
young_1       Heart           M       young
young_2       Heart           M       young
young_3       Heart           M       young
young_4       Heart           M       young
young_5       Heart           M       young
...             ...         ...         ...
old_9         Heart           M         old
old_10        Heart           M         old
old_11        Heart           F         old
old_12        Heart           M         old
old_13        Heart           F         old</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       young_1  young_2  young_3  young_4  young_5
Met_1   8.2889   9.1300   9.0886   7.9396   8.9580
Met_2  36.8705  11.2341   7.6486  13.3439  19.0862
Met_3   6.0068   3.2156   5.4975   4.6751  14.1100
Met_4  17.0962  13.3342  10.1393  16.3568  29.6947
Met_5 132.9647 145.3658 102.6457 160.7074 285.5223</code></pre>
</div>
</div>
<p>Se ha creado es SummarizedExperiment con los objetos “assays” y “colData”, ahora generaremo los metadatos del estudio y lo agregaremos al documento.</p>
</section>
<section id="descargar-metadatos-del-estudio" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="descargar-metadatos-del-estudio"><span class="header-section-number">2.2.2</span> Descargar Metadatos del Estudio</h3>
</section>
<section id="procesar-los-metadatos-desde-html" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="procesar-los-metadatos-desde-html"><span class="header-section-number">2.2.3</span> Procesar los Metadatos desde HTML</h3>
</section>
<section id="crear-el-summarizedexperiment-utilizando-el-diccionario-de-metadatos" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="crear-el-summarizedexperiment-utilizando-el-diccionario-de-metadatos"><span class="header-section-number">2.2.4</span> Crear el SummarizedExperiment Utilizando el Diccionario de Metadatos</h3>
</section>
<section id="verificamos-summarizedexperiment" class="level3" data-number="2.2.5">
<h3 data-number="2.2.5" class="anchored" data-anchor-id="verificamos-summarizedexperiment"><span class="header-section-number">2.2.5</span> Verificamos SummarizedExperiment</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 23 rows and 3 columns
             source         sex   age_group
        &lt;character&gt; &lt;character&gt; &lt;character&gt;
young_1       Heart           M       young
young_2       Heart           M       young
young_3       Heart           M       young
young_4       Heart           M       young
young_5       Heart           M       young
...             ...         ...         ...
old_9         Heart           M         old
old_10        Heart           M         old
old_11        Heart           F         old
old_12        Heart           M         old
old_13        Heart           F         old</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       young_1  young_2  young_3  young_4  young_5
Met_1   8.2889   9.1300   9.0886   7.9396   8.9580
Met_2  36.8705  11.2341   7.6486  13.3439  19.0862
Met_3   6.0068   3.2156   5.4975   4.6751  14.1100
Met_4  17.0962  13.3342  10.1393  16.3568  29.6947
Met_5 132.9647 145.3658 102.6457 160.7074 285.5223</code></pre>
</div>
</div>
<p>hemos detectadco que Assay contiene la fila “Sample” esto puede ocacionar problemas en el analisis ya que esta matriz solo debe contener datos numericos.</p>
<p>#Eliminar fila salple</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>       young_1  young_2  young_3  young_4  young_5
Met_1   8.2889   9.1300   9.0886   7.9396   8.9580
Met_2  36.8705  11.2341   7.6486  13.3439  19.0862
Met_3   6.0068   3.2156   5.4975   4.6751  14.1100
Met_4  17.0962  13.3342  10.1393  16.3568  29.6947
Met_5 132.9647 145.3658 102.6457 160.7074 285.5223</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 23 rows and 3 columns
             source         sex   age_group
        &lt;character&gt; &lt;character&gt; &lt;character&gt;
young_1       Heart           M       young
young_2       Heart           M       young
young_3       Heart           M       young
young_4       Heart           M       young
young_5       Heart           M       young
...             ...         ...         ...
old_9         Heart           M         old
old_10        Heart           M         old
old_11        Heart           F         old
old_12        Heart           M         old
old_13        Heart           F         old</code></pre>
</div>
</div>
</section>
</section>
<section id="exploracion-del-dataset" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="exploracion-del-dataset"><span class="header-section-number">2.3</span> Exploracion del dataset</h2>
<section id="informacion-del-estudio" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="informacion-del-estudio"><span class="header-section-number">2.3.1</span> Informacion del estudio</h3>
<p>Aqui tambien se trabajo dinamicamente aprovechando la informacion almacenda en medatada del SummarizedExperiment</p>
</section>
</section>
<section id="control-de-calidad-de-los-datos" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="control-de-calidad-de-los-datos"><span class="header-section-number">2.4</span> Control de calidad de los datos</h2>
<section id="control-de-calidad-de-los-metadatos-coldata" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="control-de-calidad-de-los-metadatos-coldata"><span class="header-section-number">2.4.1</span> Control de calidad de los metadatos (colData)</h3>
<p>Verificar Valores Faltantes (NA) o (NULL) y que las categorias de las variables no contengan errores tipograficos.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M" "F"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "young" "old"  </code></pre>
</div>
</div>
</section>
<section id="control-de-calidad-de-la-matriz-de-datos-cuantitativos-assay" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="control-de-calidad-de-la-matriz-de-datos-cuantitativos-assay"><span class="header-section-number">2.4.2</span> Control de Calidad de la Matriz de Datos Cuantitativos (assay)</h3>
<p>Verificar si existen valores extemos o atipicos y tambien verificar la distribucion de los valores cuantitativos en busca de sesgo.</p>
<section id="primero-revisaremso-el-tipo-de-datos" class="level4" data-number="2.4.2.1">
<h4 data-number="2.4.2.1" class="anchored" data-anchor-id="primero-revisaremso-el-tipo-de-datos"><span class="header-section-number">2.4.2.1</span> Primero revisaremso el tipo de datos</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Verificando tipos de datos en la matriz cuantitativa:"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "numeric"</code></pre>
</div>
</div>
<p>Si algún valor no es numérico, convertir toda la matriz a numérico</p>
</section>
<section id="transformado-a-datos-numericos" class="level4" data-number="2.4.2.2">
<h4 data-number="2.4.2.2" class="anchored" data-anchor-id="transformado-a-datos-numericos"><span class="header-section-number">2.4.2.2</span> Transformado a datos numericos</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Todos los datos son numéricos."</code></pre>
</div>
</div>
</section>
<section id="identificar-valores-extremos-na-en-la-matriz-de" class="level4" data-number="2.4.2.3">
<h4 data-number="2.4.2.3" class="anchored" data-anchor-id="identificar-valores-extremos-na-en-la-matriz-de"><span class="header-section-number">2.4.2.3</span> Identificar valores extremos, NA en la matriz de</h4>
<p>el numero de valores NA es de 4 que representa un 0.1% este valor es lo suficiente bajo para poder ser solo eliminado sin afectar el analisis</p>
</section>
<section id="eliminar-filas-con-valores-na" class="level4" data-number="2.4.2.4">
<h4 data-number="2.4.2.4" class="anchored" data-anchor-id="eliminar-filas-con-valores-na"><span class="header-section-number">2.4.2.4</span> Eliminar Filas con Valores NA</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Número de metabolitos después de eliminar filas con NA: 176"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Número de muestras: 23"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Número total de valores NA después de eliminar filas con NA: 0"</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="exploracion-de-los-datos" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="exploracion-de-los-datos"><span class="header-section-number">2.5</span> Exploracion de los datos</h2>
<section id="resumen-estadístico-de-la-matriz-cuantitativa" class="level3" data-number="2.5.1">
<h3 data-number="2.5.1" class="anchored" data-anchor-id="resumen-estadístico-de-la-matriz-cuantitativa"><span class="header-section-number">2.5.1</span> Resumen Estadístico de la Matriz Cuantitativa</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Resumen estadístico de la matriz cuantitativa :"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
    0.00     3.61    30.05   621.73   173.60 85543.64 </code></pre>
</div>
</div>
<p>Los valores cuantitativos de la matriz oscilan entre un mínimo de 0.00 y un máximo de 85,543.64. Estos datos con gran variabilidad es comun en estudios de metabolómica, donde algunos metabolitos están presentes en concentraciones muy elevadas, mientras que la mayoría están en concentraciones más bajas.</p>
<p>La media de los valores fue de 605.26, mientras que la mediana se situó en 28.06. Hay algunos valores extremadamente altos que están afectando el promedio general, lo que es reflejo de una distribución asimétrica con una “cola larga” hacia valores mayores como vemos en el siguiente grafico.</p>
</section>
<section id="visualización-general-histograma-de-todos-los-valores" class="level3" data-number="2.5.2">
<h3 data-number="2.5.2" class="anchored" data-anchor-id="visualización-general-histograma-de-todos-los-valores"><span class="header-section-number">2.5.2</span> Visualización General: Histograma de Todos los Valores</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>El Histograma tiene una distribucion no normal con sesgo a la Izquierda comprobando la informacion del resumen.</p>
<p>Este tipo de visualización, con tantos valores concentrados en la parte baja del eje x, dificulta la interpretación, ya que no permite ver claramente la variabilidad o patrones entre los valores más bajos y los más altos. Además, puede ser que haya valores atípicos (outliers) que estén causando la cola larga hacia la derecha, lo cual es importante investigar para no afectar el análisis posterior.</p>
<p>Para reducir el sesgo hacia la derecha, realizaremos una transformación logarítmica en los valores de los metabolitos. Esto permitirá que los datos se distribuyan de manera más uniforme y que los valores extremos no tengan tanto peso.</p>
</section>
<section id="normalizacion-transformación-logarítmica" class="level3" data-number="2.5.3">
<h3 data-number="2.5.3" class="anchored" data-anchor-id="normalizacion-transformación-logarítmica"><span class="header-section-number">2.5.3</span> Normalizacion: Transformación Logarítmica</h3>
<p>Utilizamos log1p() para calcular log(1 + valor), evitando problemas de indefinición.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Resumen estadístico de la matriz cuantitativa transformada logarítmicamente:"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
 0.002896  1.527495  3.435641  3.530163  5.162507 11.356794 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Comparando ambos hitogramas (antes y despues) eñ sesgp se ha reducido cosiderablemente, siempre se ve la concentracion de valores cercanos a cero pero la distribucion general a mejorado. Observams un pico inicial entre 0 y 1 que es comun en los datos de metabolomica.</p>
</section>
</section>
<section id="análisis-de-los-datos" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="análisis-de-los-datos"><span class="header-section-number">2.6</span> Análisis de los datos</h2>
</section>
<section id="pregunta-a-responder-existen-diferencias-significativas-en-los-perfiles-metabólicos-del-tejido-cardiaco-entre-individuos-jóvenes-y-mayores-y-cuáles-son-las-principales-características-que-permiten-diferenciar-entre-estos-grupos" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="pregunta-a-responder-existen-diferencias-significativas-en-los-perfiles-metabólicos-del-tejido-cardiaco-entre-individuos-jóvenes-y-mayores-y-cuáles-son-las-principales-características-que-permiten-diferenciar-entre-estos-grupos"><span class="header-section-number">2.7</span> Pregunta a responder: “¿Existen diferencias significativas en los perfiles metabólicos del tejido cardiaco entre individuos jóvenes y mayores, y cuáles son las principales características que permiten diferenciar entre estos grupos?”</h2>
<section id="análisis-de-componentes-principales-pca-usando-mixomics-de-los-datos-transformados" class="level3" data-number="2.7.1">
<h3 data-number="2.7.1" class="anchored" data-anchor-id="análisis-de-componentes-principales-pca-usando-mixomics-de-los-datos-transformados"><span class="header-section-number">2.7.1</span> Análisis de Componentes Principales PCA usando mixOmics de los datos transformados</h3>
<p>Nos permitirá visualizar la variabilidad general en los datos y determinar si existen diferencias metabólicas que puedan separar a los individuos jóvenes de los mayores en el espacio de componentes principales. Si observamos una separación clara entre ambos grupos en el gráfico del PCA, esto sugerirá que existen patrones metabólicos diferenciados.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Porcentaje de varianza explicada por cada componente principal:"
[1] "PC1: 45.22%"
[1] "PC2: 14.59%"
[1] "PC3: 7.46%"
[1] "PC4: 6.94%"
[1] "PC5: 4.46%"</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Hemos analizado las 5 primeras PCs, las primeras dos explicar el 59.81% de la varianza total, lo cual es significativo.</p>
<p>El grafico muestra las dos primeras componenetes, vemos un numero de muestras young agurpadas en una region apartada a lo largo de PC1 con lo que podemos deducir una diferencia significativa entre los dos grupos en los metabolitos evaluados.</p>
<section id="contribución-de-metabolitos-a-los-componentes-principales" class="level4" data-number="2.7.1.1">
<h4 data-number="2.7.1.1" class="anchored" data-anchor-id="contribución-de-metabolitos-a-los-componentes-principales"><span class="header-section-number">2.7.1.1</span> Contribución de Metabolitos a los Componentes Principales</h4>
<p>Ahora vamos a explorar los metabolitos que mas contribuyen a la variabilidad de la PC1, para ello vamos a mostra los 10 loadings mas altos.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Metabolitos con mayor contribución al PC1 (posible diferencia entre young y old):"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   Met_68    Met_71   Met_113    Met_44    Met_90    Met_86    Met_31    Met_69 
0.1097176 0.1074566 0.1074332 0.1068631 0.1066033 0.1064655 0.1064305 0.1063863 
   Met_84    Met_82 
0.1061121 0.1060418 </code></pre>
</div>
</div>
</section>
</section>
<section id="análisis-discriminante-pls-usando-mixomics-de-los-datos-transformados" class="level3" data-number="2.7.2">
<h3 data-number="2.7.2" class="anchored" data-anchor-id="análisis-discriminante-pls-usando-mixomics-de-los-datos-transformados"><span class="header-section-number">2.7.2</span> Análisis Discriminante PLS usando mixOmics de los datos transformados</h3>
<p>Identificar metabolitos específicos que contribuyen a la diferenciación entre los grupos de edad. Esto nos permitirá responder qué características o metabolitos cambian de manera significativa con la edad.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-24-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Pec1_files/figure-html/unnamed-chunk-24-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="gráfico-de-tasa-de-error-de-clasificación" class="level3" data-number="2.7.3">
<h3 data-number="2.7.3" class="anchored" data-anchor-id="gráfico-de-tasa-de-error-de-clasificación"><span class="header-section-number">2.7.3</span> Gráfico de Tasa de Error de Clasificación</h3>
<p>La tasa de error disminuye significativamente con PC1 y PC2 confirmando la importacia de estas componentes, a partir de la PC3 el error se mantiene estable con lo que añadir mas componentes no mejora mucho la clasificacion.</p>
</section>
<section id="grafico-pls-da-componentes-principales-1-y-2" class="level3" data-number="2.7.4">
<h3 data-number="2.7.4" class="anchored" data-anchor-id="grafico-pls-da-componentes-principales-1-y-2"><span class="header-section-number">2.7.4</span> Grafico PLS-DA: Componentes principales 1 y 2):</h3>
<p>Los componentes 1 y 2 del PLS-DA parecen ser suficientes para capturar diferencias metabólicas entre los grupos young y old. La separación observada confirma que existen metabolitos clave que diferencian las dos poblaciones</p>
</section>
<section id="graficar-el-círculo-de-correlación" class="level3" data-number="2.7.5">
<h3 data-number="2.7.5" class="anchored" data-anchor-id="graficar-el-círculo-de-correlación"><span class="header-section-number">2.7.5</span> Graficar el círculo de correlación</h3>
<p>Los metabolitos que se encuentran más alejados del centro del círculo tienen una mayor contribución al modelo de PLS-DA. En este caso, podemos observar que los metabolitos Met_23, Met_26, Met_27, Met_28, etc., están más alejados del origen. Estos metabolitos, al estar alejados, sugieren que tienen una fuerte correlación con los componentes principales seleccionados (PC1 y PC2) y, por tanto, juegan un papel importante en la separación entre los grupos young y old.</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>